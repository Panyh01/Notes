# [JSP](./index.md) | 01 Servlet基础

## 概念

Servlet（Server Applet），全称`Java Servlet`。  

Sevlet本质上是一段**Java程序或代码**，其运行在服务器端，用于响应客户端的请求。

Servlet是继承自`HttpServlet类`的Java类，通常由三个部分构成：  

- **导入的包**  

  ```java
  import java.io.*;
  import javax.servlet.*;
  ...
  ```
  
- **处理请求的方法**,包括``doGet()``和``doPost()``方法  

  ```java
  public void doGet(HttpServletRequest request,  
  HttpServletResponse response) throws 
  ServletException, IOException {
    //代码块
    }
  ```

- **向客户端发送的数据**
  
  ```java
  //上面代码块中的内容
  response.setContext("text/html;charset=UTF-8");
  PrintWriter out=response.getWriter();
  out.println("<html><head>
  <title>MyJSP</title>
  </head>
    <body>
      Hello World!<br>
    </body>
  </html>");
  ```

## Servlet和JSP的关系

JSP经过编译后生成的就是Servlet文件，JSP是Servlet的简化；  
JSP侧重视图，而Servlet主要用于逻辑控制。

JSP是Java和HTML组合的`.jsp`扩展文件，Sevlet则是纯Java代码；  
JSP中有内置对象，而Sevlet中没有。

Servlet能更好地组织业务逻辑代码，但是HTML代码可读性差、维护困难；  
JSP虽然规避了上述劣势，但是由于在HTML中混入大量Java代码，一样不可取。

注：后面学的MVC设计模式能够规避两者的短板。

## Servlet 接口和API

Servlet API所在包：

1. **javax.servlet包**  
包括**Servlet、ServletRequest、ServletResponse、ServletConfig、ServletContext接口**以及**抽象类GenericServlet**.
2. **javax.servlet.http包**  
用于支持HTTP的Servlet API.

大概过程：  

&emsp;&emsp;当容器载入一个Servlet文件后，会建立该文件的Servlet接口实例。然后根据Servlet接口设定的初始化配置和其他信息（一般在web.xml中）创建一个ServletConfig实例。通过Servlet接口的init()方法传入该ServletConfig实例完成对Servlet实例的初始化。  

&emsp;&emsp;Servlet实例初始化完成后，当收到请求时，容器先通过urlPattern找到该Servlet实例，再调用其service()方法，传入ServletRequest、ServletResponse实例。  

&emsp;&emsp;Servlet实例在使用完回收前，容器通过destroy()方法执行资源的回收与释放。

## Servlet 接口

**所有的Servlet类都必须实现该接口。**  

Servlet 接口定义了5个方法，其中3个由Servlet容器调用，2个可以在JavaWeb的程序代码里访问。  

1. **init(ServletConfig config)**  
负责初始化Servlet对象，容器创建好Servlet对象后调用  
2. **service(ServletRequest req, ServletResponse res)**  
负责响应客户端请求，当用户要求访问特定Servlet对象时调用  
3. **destroy()**  
负责释放Servlet对象占用的资源，当Servlet对象结束生命周期时调用

***

4. **getServletConfig()**  
返回一个ServletConfig对象，该对象包含Servlet的初始化信息  
5. **getServletInfo()**  
返回一个字符串，其包含了Servlet创建者、版本和版权等信息

## GenericServlet 抽象类

由于Servlet接口编写的Servlet类要实现5个方法，比较麻烦，于是有了GenericServlet抽象类。  

该类定义了一个通用的、不依赖具体协议的Servlet，**实现了Servlet接口和ServletConfig接口**。该类给出了除``service()``方法以外其他4个方法的简单实现。通过GenericServlet编写Servlet类只需实现service()方法即可。

## HttpServlet 抽象类

一般，客户端通过HTTP协议访问服务器资源。Sun公司提供了抽象类HttpServlet，它**继承自GenericServlet类**，用来创建适合Web站点的HTTP Servlet。

针对HTTP1.1定义的7种请求方法，HttpServlet提供了7个处理方法：

> doGet()，doPost()，doHead()，doPut()，doDelete()，doTrace()，doOptions()  

注：TRACE和OPTIONS做了适当实现；  
&emsp;&emsp;其他5个方法只提供了返回HTTP错误的实现。

我们常用的一般是``doGet()``方法和``doPost()``方法。

当容器接收到针对HttpServlet对象的请求时，调用过程如下：  

1. 调用``Public service()``方法  
2. 在``Public service()``方法中，将参数类型转换为``HttpServletRequest``和``HttpServletResponse``，然后将转换后的这两个对象作为参数传递给``Protected service()``方法
3. 在``Protected service()``方法中，首先调用``HttpServletRequest``对象的``getMethod()``方法，获取HTTP请求类型，调用相应的``doXxx()``方法

因此，在编写HttpServlet的派生类时，一般不用覆写``service()``方法，而只需要重写相应的``doXxx()``方法即可。

## 与请求和响应相关的接口

当容器接收到客户端的请求时，会创建一个``ServletRequest``对象，用来封装请求的数据，同时创建一个``ServletResponse``对象，用来封装响应的数据，这两个对象作为参数传入``service()``方法，Servlet再通过``service()``方法获取请求和发送响应。  

``HttpServletRequest``接口和``HttpServletResponse``接口分别继承自``ServletRequest``接口和``ServletResponse``接口，并在原有基础上新增了一些方法，比如请求常用的``getSession()``方法，响应常用的``sendRedirect()``方法。

## ServletConfig 接口

初始化Servlet对象时，使用``ServletConfig``对象获取初始化参数（从web.xml中获取）。一个Servlet只有一个ServletConfig对象。

在ServletConfig接口中，定义了4个方法：

1. **getInitParameter()**
通过传入的参数名获取对应初始参数值，即``web.xml``配置中的``<init-param>``参数或者``@WebServlet``注解中的``initParams``属性元素；  
2. **getInitParameterNames()**
返回一个``Enumeration<String>``对象，没有参数时返回空值；
3. **getServletContext()**
返回当前正在运行的web应用的ServletContext对象；
4. **getServletName()**
返回Servlet实例的名称，即``web.xml``配置中的``<servlet-name>``或``@WebServlet``中的name属性，未配置时返回该实例的类名（可通过xxx.class.getName()获取）。

***

[上一章：00.开始之前](./00.开始之前.md)  

[下一章：00.Servlet基础](./01.Servlet基础.md)  

[返回目录](./index.md)